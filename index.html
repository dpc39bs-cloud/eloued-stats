<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>نظام الحصيلة الرقمي - ولاية الوادي</title>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --primary: #1a237e; --secondary: #ffd700; --danger: #d32f2f; --success: #2e7d32; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f0f2f5; margin: 0; padding: 20px; }
        .hidden { display: none !important; }
        .card { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); margin-bottom: 20px; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; background: white; font-size: 14px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: center; }
        th { background: var(--primary); color: white; }
        input[type="number"] { width: 50px; border: none; text-align: center; font-weight: bold; -moz-appearance: textfield; }
        input::-webkit-outer-spin-button, input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
        .btn { cursor: pointer; border: none; padding: 10px 20px; border-radius: 5px; font-weight: bold; color: white; background: var(--primary); }
        
        @media print {
            .no-print { display: none !important; }
            body { background: white; padding: 0; }
            .card { box-shadow: none; border: 1px solid #000; }
            #monthly-report-section:not(.hidden) { page-break-before: always; display: block !important; }
            table { border: 2px solid #000 !important; }
        }
    </style>
</head>
<body>

    <div id="login-page" class="card" style="max-width: 400px; margin: 100px auto; text-align: center;">
        <h2 style="color: var(--primary);">تسجيل الدخول</h2>
        <select id="user-role" class="btn" style="background: #eee; color: #333; width: 100%; margin-bottom: 10px;">
            <option>المتحكم الرئيسي</option>
            <option>وحدة الرقيبة</option>
            <option>وحدة قمار</option>
            <option>وحدة حاسي خليفة</option>
            </select>
        <input type="password" id="pass-code" placeholder="كلمة المرور" style="width: 90%; padding: 10px; margin-bottom: 20px; border-radius: 5px; border: 1px solid #ddd;">
        <button class="btn" onclick="login()" style="width: 100%;">دخول</button>
    </div>

    <div id="app-content" class="hidden">
        <div class="card no-print" style="display: flex; justify-content: space-between; align-items: center;">
            <h3 id="user-tag" style="margin: 0; color: var(--primary);"></h3>
            <div>
                <input type="week" id="week-picker" class="btn" style="background: #eee; color: #333;">
                <button class="btn" style="background: var(--danger);" onclick="location.reload()">خروج</button>
            </div>
        </div>

        <div id="status-panel" class="hidden card no-print"></div>

        <div class="unit-section hidden">
            <div class="card">
                <h3 style="text-align: center; color: var(--primary);">الحصيلة الأسبوعية الرقمية</h3>
                <table id="main-table">
                    <thead>
                        <tr>
                            <th rowspan="2">اليوم</th>
                            <th colspan="4">الإسعاف</th><th colspan="4">حوادث المرور</th>
                            <th colspan="4">الحرائق</th><th colspan="4">مختلفة</th>
                            <th rowspan="2">ع ت</th>
                        </tr>
                        <tr style="font-size: 11px;">
                            <th>ع ع</th><th>ع ت</th><th>م</th><th>و</th>
                            <th>ع ع</th><th>ع ت</th><th>م</th><th>و</th>
                            <th>ع ع</th><th>ع ت</th><th>م</th><th>و</th>
                            <th>ع ع</th><th>ع ت</th><th>م</th><th>و</th>
                        </tr>
                    </thead>
                    <tbody id="daily-body"></tbody>
                    <tfoot id="daily-foot"></tfoot>
                </table>
                <div style="margin-top: 20px; text-align: center;" class="no-print">
                    <button class="btn" style="background: var(--success);" onclick="saveToCloud()"><i class="fa-solid fa-cloud-arrow-up"></i> حفظ وإرسال للسحابة</button>
                    <button class="btn" onclick="window.print()"><i class="fa-solid fa-print"></i> طباعة الأسبوع</button>
                    <button class="btn" style="background: #6a1b9a;" onclick="generateMonthlyReport()"><i class="fa-solid fa-calendar-check"></i> استخراج الحصيلة الشهرية</button>
                </div>
            </div>
        </div>

        <div id="monthly-report-section" class="card hidden">
            <h3 style="text-align: center; color: var(--primary); border-bottom: 2px solid var(--secondary); padding-bottom: 10px;">إجمالي الحصيلة الشهرية</h3>
            <table>
                <thead>
                    <tr style="background: #333;">
                        <th>البيان</th>
                        <th>ع ع</th><th>ع ت</th><th>م</th><th>و</th>
                        <th>ع ع</th><th>ع ت</th><th>م</th><th>و</th>
                        <th>ع ع</th><th>ع ت</th><th>م</th><th>و</th>
                        <th>ع ع</th><th>ع ت</th><th>م</th><th>و</th>
                        <th style="background: var(--secondary); color: black;">الإجمالي ع ت</th>
                    </tr>
                </thead>
                <tbody id="monthly-body"></tbody>
            </table>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
