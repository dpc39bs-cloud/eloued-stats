<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>منظومة إحصاء ولاية الوادي - أونلاين</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>

    <style>
        /* التنسيقات التي اعتمدناها سابقاً مع الخطوط الكبيرة */
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f4f7f6; margin: 20px; font-size: 18px; }
        .container { max-width: 1200px; margin: auto; background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        h2 { text-align: center; color: #2c3e50; font-size: 32px; margin-bottom: 30px; border-bottom: 3px solid #3498db; padding-bottom: 10px; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 2px solid #ddd; padding: 15px; text-align: center; font-size: 20px; }
        th { background-color: #3498db; color: white; }
        input[type="number"] { width: 90%; padding: 10px; font-size: 20px; border: 1px solid #ccc; border-radius: 5px; text-align: center; }
        /* إخفاء أزرار الزيادة والنقصان بناءً على طلبك */
        input::-webkit-outer-spin-button, input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
        .btn-save { background-color: #27ae60; color: white; padding: 15px 40px; border: none; border-radius: 8px; cursor: pointer; font-size: 22px; width: 100%; margin-top: 20px; font-weight: bold; }
        .status { text-align: center; margin-top: 10px; font-weight: bold; color: #2980b9; }
        @media print { .btn-save, .status { display: none; } }
    </style>
</head>
<body>

<div class="container">
    <h2>نظام نتائج الرقمنة - ولاية الوادي (Online)</h2>
    
    <div id="status" class="status">جاري الاتصال بقاعدة البيانات...</div>

    <table id="statsTable">
        <thead>
            <tr>
                <th>البيان (الإحصائية)</th>
                <th>القيمة المستهدفة</th>
                <th>المحقق</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>عدد بطاقات التعريف المرقمنة</td>
                <td><input type="number" id="id_cards_target"></td>
                <td><input type="number" id="id_cards_done"></td>
            </tr>
            <tr>
                <td>عقود الحالة المدنية</td>
                <td><input type="number" id="contracts_target"></td>
                <td><input type="number" id="contracts_done"></td>
            </tr>
            </tbody>
    </table>

    <button class="btn-save" onclick="saveData()">حفظ البيانات أونلاين ✅</button>
</div>

<script>
    // إعدادات Firebase الخاصة بك
    const firebaseConfig = {
        apiKey: "AIzaSyBxYbKWfBM-e2wE1ry_SNDSDaSi2k3IgHY",
        authDomain: "eloued-system.firebaseapp.com",
        projectId: "eloued-system",
        storageBucket: "eloued-system.firebasestorage.app",
        messagingSenderId: "215124234121",
        appId: "1:215124234121:web:01536290ef78a417a71b58"
    };

    // تهيئة Firebase
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    // دالة لجلب البيانات عند فتح الصفحة
    function loadData() {
        const statusDiv = document.getElementById('status');
        database.ref('statistics/').once('value').then((snapshot) => {
            const data = snapshot.val();
            if (data) {
                document.getElementById('id_cards_target').value = data.id_cards_target || "";
                document.getElementById('id_cards_done').value = data.id_cards_done || "";
                document.getElementById('contracts_target').value = data.contracts_target || "";
                document.getElementById('contracts_done').value = data.contracts_done || "";
                statusDiv.innerText = "تم تحديث البيانات من السحابة بنجاح ✅";
            } else {
                statusDiv.innerText = "لا توجد بيانات سابقة، ابدأ الإدخال الآن.";
            }
        }).catch(err => {
            statusDiv.innerText = "خطأ في الاتصال: تأكد من تفعيل Test Mode في Firebase";
        });
    }

    // دالة لحفظ البيانات
    function saveData() {
        const statusDiv = document.getElementById('status');
        statusDiv.innerText = "جاري الحفظ أونلاين... ⏳";

        const dataToSave = {
            id_cards_target: document.getElementById('id_cards_target').value,
            id_cards_done: document.getElementById('id_cards_done').value,
            contracts_target: document.getElementById('contracts_target').value,
            contracts_done: document.getElementById('contracts_done').value,
            last_update: new Date().toLocaleString('ar-DZ')
        };

        database.ref('statistics/').set(dataToSave)
            .then(() => {
                statusDiv.innerText = "تم الحفظ بنجاح في قاعدة البيانات المركزية! ✅";
                alert("تم مزامنة البيانات مع السحابة بنجاح!");
            })
            .catch((error) => {
                statusDiv.innerText = "فشل الحفظ: " + error.message;
            });
    }

    // تشغيل جلب البيانات فور تحميل الصفحة
    window.onload = loadData;
</script>

</body>
</html>